/*!
 * multilist v0.9.3
 * built 2015-06-04
 * Copyright (C) 2014 Nicholas Ortenzio and Jason Duncan
 * Released under the MIT license
 * http://jquery.org/license
 */
!function(a){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var b="multilist",c="multilistitem",d={canRemove:!1,datalist:null,enableSearch:!0,initWithCallback:!0,labelText:"",maxSelected:10,closeOnMax:!1,onChange:function(){},onRemove:function(){},transitionSpeed:"fast",single:!1},e="selected",f="disabled",g="filtered",h="opened",i="multilist-shell",j=[{type:"keyup",selector:'input[role="search"]',callback:function(a,c,d){var e=c.val().toLowerCase();a[b]("filter",e)}},{type:"click",selector:".items a",callback:function(c,d,g){g.preventDefault(),d.is("div")&&(d=d.parent());var h=c.data(b),i=d.attr("value"),j=d.text();h.single&&(h.$items.removeClass(e),a("span.labeltext",h.$label).text(j)),d.hasClass(f)||!d.hasClass(e)&&h.maxSelected>0&&o(c)>=h.maxSelected||(d.toggleClass(e),h.onChange(i,j,d.hasClass(e),c),h.maxSelected==o(c)&&h.closeOnMax&&c[b]("close"),c[b]("serialize"))}}],k=[{type:"click",selector:"a.label",callback:function(a,c,d){d.preventDefault(),a.hasClass(f)||a[b](a.hasClass(h)?"close":"open")}},{type:"click",selector:"a.remove",callback:function(a,c,d){d.preventDefault(),a[b]("remove",!0)}},{type:"click",selector:"div.label span.add",callback:function(b,c,d){a("a.label",c.parent()).trigger("click")}}],l={base:['<div class="inner">','  <div class="multilist-holder label {{if canRemove}}removable{{/if}}">','    <span class="ui-sprite add">+</span>','    <a href="#" class="label">','      <span class="labeltext">${labelText}</span>',"    </a>",'    {{if canRemove}}<a href="#" class="remove">x</a>{{/if}}',"  </div>",'  <div class="multilist-shell">',"    {{if enableSearch}}",'    <div class="multilist-holder search">','      <input role="search" placeholder="Search" spellcheck="false" autocorrect="false" type="text" />',"    </div>","    {{/if}}",'    <div class="multilist-holder items">','      <ul role="listbox"></ul>',"    </div>","  </div>","</div>",'<input type="hidden" name="${name}" />'].join(""),items:["<li>",'  <a href="#" role="option" value="${value}" class="item {{if selected}}selected{{/if}}" title="${description}" >','    {{if $item.renderCheckbox}}<div class="ui-sprite checkbox"></div>{{/if}}',"    ${text}","  </a>","</li>"].join("")};a.each(l,function(b,c){a.template(b,c)});var m={init:function(c){return this.each(function(){var f=a.extend({},d,c),g=a(this).addClass(b).attr("role","listbox").attr("aria-multiselectable","true").show(),h=this,l=g.attr("name");if(a.tmpl("base",a.extend({},f,{name:l})).appendTo(g),f.$this=g,f.$label=g.find(".multilist-holder.label"),f.$shold=g.find(".multilist-holder.search"),f.$search=g.find("input"),f.$holder=g.find(".multilist-holder.items"),f.$list=f.$holder.find("ul"),f.$hidden=g.find('input[name="'+l+'"]'),f.$shell=g.find("."+i),a.each(k,function(a,b){g.on(b.type,b.selector,q.bind(h,b.callback))}),a.each(j,function(a,b){f.$shell.on(b.type,b.selector,q.bind(h,b.callback))}),a.each(g.prop("attributes"),function(){this.name.indexOf("data-")>-1&&f.$hidden.attr(this.name,this.value)}),f.datalist){f.datalist=a.map(f.datalist,function(a){return{text:p(a,"text"),value:p(a,"value"),selected:p(a,"selected")}});var m=a.tmpl("items",f.datalist,{renderCheckbox:!f.single});f.$list.empty().append(m)}f.single&&(f.closeOnMax=!0,f.maxSelected=1),f.$items=f.$list.find("a"),g.removeAttr("name"),g.data(b,f),f.single&&a(f.$items.selector+"."+e).trigger("click")})},clear:function(b,c){var d=c.$items.filter("."+e);d.removeClass(e).attr("aria-selected","false"),b.attr("value","").attr("aria-valuetext",""),a("span.labeltext",c.$label).text(c.labelText),c.$hidden.val("")},close:function(a,b){var c=a.hasClass(h);c&&(b.enableSearch&&(b.$search.val(""),b.$items.removeClass(g)),b.$shell.slideUp(b.transitionSpeed,function(){a.removeClass(h),b.$shold.hide(),b.$shell.appendTo(a),b.$shell.hide()}))},deselect:function(b,c,d,f){var g=c.$items.filter('[value="'+d+'"]');if(0!==g.length){g.removeClass(e).attr("aria-selected","false");var h=b.find("."+e).map(function(){return a(this).attr("value")}).splice(0).join("|");b.attr("value",h).attr("aria-valuetext",h),f&&c.onChange([],b)}},disable:function(a,b){a.addClass(f)},enable:function(a,b){a.removeClass(f)},filter:function(b,c,d){var e=c.$items;return d.length<3?void e.removeClass(g):void a.each(e,n.bind(this,d))},getSelected:function(b,c){var d=c.$items.filter("."+e),f=a.map(d,function(b,c){return a(b).attr("value")});return f},open:function(b,c){c.$shell.appendTo(a("body"));var d=c.$this.offset();c.$shell.css({top:d.top+c.$this.height(),left:d.left,width:c.$this.width()}),c.$holder.show(),c.enableSearch&&c.$shold.show(),c.$shell.slideDown(c.transitionSpeed,function(){b.addClass(h),c.$search.focus()})},remove:function(a,b,c){c&&b.onRemove(a),b.$shell.appendTo(a),a.remove()},serialize:function(b,c){var d=c.$items.filter("."+e),f=a.map(d,function(b,c){return a(b).attr("value")}).join("|");return b.attr("value",f).attr("aria-valuetext",f),c.$hidden.val(f),f},setValue:function(a,c,d,f){var g=d.split("|");for(var h in g)c.$items.filter('[value="'+g[h]+'"]').addClass(e).attr("aria-selected","true");var i=a[b]("serialize");f&&c.onChange(i,a)},updateItems:function(a,b){b.$items=a.find("> ul > li > a"),m.setLabel(data)}},n=function(b,d,e){var f=a(e),h=f.attr("value").toLowerCase(),i=f.text().toLowerCase(),j=f.data(c);if(h.indexOf(b)>-1)return void f.removeClass(g);if(i.indexOf(b)>-1)return void f.removeClass(g);if(j&&j.fields)for(var k=0;k<j.fields.length;k+=1){var l=j.fields[k].toLowerCase();if(l.indexOf(b)>-1)return void f.removeClass(g)}f.addClass(g)},o=function(a){var c=a.data(b);return c.$holder.find("."+e).length},p=function(a,b){var c=a[b];return void 0==c?a[b.charAt(0).toUpperCase()+b.slice(1)]:c},q=function(b,c){var d=a(this),e=a(c.target);b(d,e,c)};a.fn[b]=function(c){if(m[c]){var d=a(this),e=d.data(b),f=[d,e].concat(Array.prototype.slice.call(arguments,1));return m[c].apply(this,f)}return"object"!=typeof c&&c?void a.error("Method "+c+" does not exist"):m.init.apply(this,arguments)}}(jQuery);